/* eslint-disable prefer-const */
/**
 * @module moveObstacles.ts
 * @function moveObstacles
 */
import { checkTimerWorking } from "../time/isTimer"
import selectObstacleDirection from "./selectObstacleDirection"
import * as X from "./obstaclesX"
import * as Y from "./obstaclesY"
import checkObstaclePosition from "./checkObstaclePosition"
import setObstacleStep from "./setObstacleStep"
import { getSnakeHeadParams } from "../snake/snake"
import { getStep } from "../time/timerStepPerLevel"

function moveObstacles(type: string): void {
  const stopDistance = getStep() + 2
  const isSnakeMoving =
    getSnakeHeadParams().snakeHeadStepX !== 0 ||
    getSnakeHeadParams().snakeHeadStepY !== 0
  const { coord, step } = selectObstacleDirection(type)

  if (!checkTimerWorking()) return

  const twist = type === 'y' ? [0, 1] : [1, 0]

  for (let i = 0; i < coord.length; i++) {
    const newPos = [...coord[i]]
    step[i] = setObstacleStep({ i, twist, coord, step })
    type === 'x' ? X.setObstaclesStepX(step) : Y.setObstaclesStepY(step)
    newPos[twist[0]] += step[i]
    let newStep = checkObstaclePosition(newPos) ? step[i] : 0
    newStep =
      Math.abs(coord[i][0] - getSnakeHeadParams().snakeHeadCoordX) <
        stopDistance &&
      Math.abs(coord[i][1] - getSnakeHeadParams().snakeHeadCoordY) <
        stopDistance &&
      isSnakeMoving
        ? 0
        : newStep
    coord[i][twist[0]] += newStep
  }

  if (type === 'x') {
    X.setObstaclesXCoord(coord)
  } else {
    Y.setObstaclesYCoord(coord)
  }
}

export default moveObstacles
